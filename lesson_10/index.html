<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список книг</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .description {
            color: #7f8c8d;
            font-size: 16px;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            gap: 10px;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        #refreshBtn {
            background-color: #27ae60;
        }

        #refreshBtn:hover {
            background-color: #219653;
        }

        .status {
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
        }

        .loading {
            background-color: #fff9e6;
            color: #e67e22;
            display: block;
        }

        .error {
            background-color: #ffe6e6;
            color: #e74c3c;
            display: block;
        }

        .success {
            background-color: #e6f7e6;
            color: #27ae60;
            display: block;
        }

        .books-container {
            margin-top: 20px;
        }

        .book-count {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 15px;
            text-align: center;
        }

        .book-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .book-card {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 20px;
            border-radius: 5px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .book-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .book-author {
            font-size: 16px;
            color: #7f8c8d;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #95a5a6;
        }

        footer {
            margin-top: 30px;
            text-align: center;
            color: #95a5a6;
            font-size: 14px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
        }

        .api-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .api-info code {
            background-color: #eaeaea;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Библиотека книг</h1>
            <p class="description">Приложение для просмотра списка книг с сервера</p>
        </header>

        <div class="controls">
            <button id="loadBtn">Загрузить книги</button>
            <button id="refreshBtn">Обновить список</button>
        </div>

        <div id="statusMessage" class="status"></div>

        <div class="api-info">
            <p>Приложение запрашивает данные с бэкенда по адресу: <code>http://127.0.0.1:8000/books</code></p>
            <p>Ожидается JSON-ответ с массивом книг, где каждая книга имеет поля <code>title</code> и <code>author</code>.</p>
        </div>

        <div class="books-container">
            <div class="book-count" id="bookCount"></div>
            <div class="book-list" id="bookList">
                <!-- Книги будут загружены здесь -->
                <div class="empty-state">
                    <h3>Список книг пуст</h3>
                    <p>Нажмите кнопку "Загрузить книги", чтобы получить данные с сервера</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Простое фронтенд-приложение для отображения списка книг</p>
        </footer>
    </div>

    <script>
        // Элементы DOM
        const loadBtn = document.getElementById('loadBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const statusMessage = document.getElementById('statusMessage');
        const bookList = document.getElementById('bookList');
        const bookCount = document.getElementById('bookCount');

        // URL для запроса книг (с учетом возможной опечатки в задании "boos" вместо "books")
        const apiUrl = 'http://127.0.0.1:8000/books';

        // Показать сообщение о статусе
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status ' + type;
        }

        // Скрыть сообщение о статусе
        function hideStatus() {
            statusMessage.style.display = 'none';
        }

        // Отобразить список книг
        function displayBooks(books) {
            if (!books || books.length === 0) {
                bookList.innerHTML = `
                    <div class="empty-state">
                        <h3>На сервере нет книг</h3>
                        <p>Сервер вернул пустой список</p>
                    </div>
                `;
                bookCount.textContent = 'Найдено 0 книг';
                return;
            }

            // Обновляем количество книг
            bookCount.textContent = `Найдено ${books.length} ${getBookWordForm(books.length)}`;

            // Создаем карточки для каждой книги
            let booksHTML = '';
            books.forEach(book => {
                booksHTML += `
                    <div class="book-card">
                        <div class="book-title">${escapeHtml(book.title || 'Без названия')}</div>
                        <div class="book-author">${escapeHtml(book.author || 'Автор неизвестен')}</div>
                    </div>
                `;
            });

            bookList.innerHTML = booksHTML;
        }

        // Получить правильную форму слова "книга"
        function getBookWordForm(number) {
            if (number % 10 === 1 && number % 100 !== 11) {
                return 'книга';
            } else if ([2, 3, 4].includes(number % 10) && ![12, 13, 14].includes(number % 100)) {
                return 'книги';
            } else {
                return 'книг';
            }
        }

        // Экранирование HTML для безопасности
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Загрузить книги с сервера
        async function loadBooks() {
            showStatus('Загрузка книг с сервера...', 'loading');

            try {
                // Выполняем запрос к API
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status} ${response.statusText}`);
                }

                const books = await response.json();

                // Проверяем, что получен массив
                if (!Array.isArray(books)) {
                    throw new Error('Сервер вернул не массив книг');
                }

                // Отображаем книги
                displayBooks(books);
                showStatus(`Успешно загружено ${books.length} ${getBookWordForm(books.length)}`, 'success');

                // Скрываем сообщение об успехе через 3 секунды
                setTimeout(hideStatus, 3000);

            } catch (error) {
                console.error('Ошибка при загрузке книг:', error);

                // Показываем сообщение об ошибке
                let errorMessage = `Не удалось загрузить книги: ${error.message}`;

                // Проверяем, связана ли ошибка с CORS или недоступностью сервера
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage = 'Не удалось подключиться к серверу. Убедитесь, что сервер запущен на http://127.0.0.1:8000 и разрешает CORS-запросы.';
                }

                showStatus(errorMessage, 'error');

                // Для демонстрации показываем тестовые данные при ошибке
                displayTestData();
            }
        }

        // Функция для отображения тестовых данных (если сервер недоступен)
        function displayTestData() {
            const testBooks = [
                { title: "Мастер и Маргарита", author: "Михаил Булгаков" },
                { title: "Преступление и наказание", author: "Федор Достоевский" },
                { title: "Война и мир", author: "Лев Толстой" },
                { title: "1984", author: "Джордж Оруэлл" },
                { title: "Гарри Поттер и философский камень", author: "Джоан Роулинг" },
                { title: "Маленький принц", author: "Антуан де Сент-Экзюпери" }
            ];

            displayBooks(testBooks);
            bookCount.textContent += ' (тестовые данные, сервер недоступен)';
        }

        // Обработчики событий
        loadBtn.addEventListener('click', loadBooks);
        refreshBtn.addEventListener('click', loadBooks);

        // Загружаем книги при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Не загружаем автоматически, чтобы избежать CORS-ошибок при открытии файла
            // Пользователь должен нажать кнопку "Загрузить книги"
        });
    </script>
</body>
</html>